<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title></title>
  </head>
  <body>
    <span>nota fiscal</span>
    <video id="preview" style="width: 400px; height: 400px"></video>

    <button id="flash-toggle">flash <span id="flash-state"></span></button>

    <h1>Scan from file</h1>
    <input type="file" id="file-selector" />
  </body>
  <script type="module">
    import QrScanner from "./vendor/qr-scanner.min.js";
    QrScanner.WORKER_PATH = "./vendor/qr-scanner-worker.min.js";

    const video = document.getElementById("preview");
    const fileSelector = document.getElementById("file-selector");

    const flashToggle = document.getElementById("flash-toggle");
    const flashState = document.getElementById("flash-state");
    const camHasFlash = document.getElementById("cam-has-flash");

    const qrScanner = new QrScanner(video, (result) =>
      alert("decoded qr code: " + result.substring(0, 44))
    );

    document.getElementById("flash-toggle").addEventListener("click", () => {
      qrScanner
        .toggleFlash()
        .then(
          () =>
            (flashState.textContent = qrScanner.isFlashOn()
              ? "ligado"
              : "desligado")
        );
    });

    const updateFlashAvaiability = () => {
      qrScanner.hasFlash().then((hasFlash) => {
        alert(hasFlash);
        flashToggle.style.display = hasFlash ? "inline-block" : "none";
      });
    };

    qrScanner.start();

    fileSelector.addEventListener("change", (event) => {
      const file = fileSelector.files[0];
      if (!file) {
        return;
      }
      QrScanner.scanImage(file)
        .then((result) => alert("decoded qr code: " + result.substring(0, 44)))
        .catch((e) => alert(result || "no qr code found."));
    });
  </script>
</html>
